@page "/"
@using Microsoft.AspNetCore.Components.Forms
@inject IWebHostEnvironment Env

<h1>Upload CSV</h1>
<p class="sub">Import transactions to analyze spendings and subscriptions</p>

<div class="card">
    <label class="btn">
        <svg viewBox="0 0 24 24"><path d="M12 3v12M7 8l5-5 5 5M5 21h14" /></svg>
        Upload CSV
        <InputFile OnChange="OnCsvSelected" accept=".csv" />
    </label>

    @if (!string.IsNullOrWhiteSpace(Status))
    {
        <div class="status">@Status</div>
    }
</div>

@code {
    string? Status;

    async Task OnCsvSelected(InputFileChangeEventArgs e)
    {
        try
        {
            var f = e.File;
            if (f == null) return;
            var dir = Path.Combine(Env.ContentRootPath, "App_Data", "uploads");
            Directory.CreateDirectory(dir);
            var path = Path.Combine(dir, $"{DateTime.UtcNow:yyyyMMddHHmmss}_{f.Name}");
            await using var r = f.OpenReadStream(10 * 1024 * 1024);
            await using var w = File.Create(path);
            await r.CopyToAsync(w);
            Status = "File uploaded";
        }
        catch (Exception ex)
        {
            Status = ex.Message;
        }
    }
}

<style>
    h1 {
        margin: 0
    }

    .sub {
        color: #aaa;
        margin: .3rem 0 1rem
    }

    .card {
        padding: 1.25rem;
        border-radius: 16px;
        background: #111;
        border: 1px solid rgba(255,255,255,.08)
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: .6rem;
        padding: .75rem 1rem;
        border-radius: 14px;
        background: #1a1a1a;
        border: 1px solid rgba(255,255,255,.1);
        cursor: pointer;
        transition: background .2s ease,transform .2s ease;
        color: #f3f3f3;
    }

        .btn:hover {
            background: #222;
            transform: translateY(-1px)
        }

        .btn svg {
            width: 18px;
            height: 18px;
            stroke: #fff;
            fill: none;
            stroke-width: 1.7
        }

        .btn input {
            position: absolute;
            opacity: 0
        }

    .status {
        margin-top: .75rem;
        color: #ccc
    }
</style>
